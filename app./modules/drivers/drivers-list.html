<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<dom-module id="drivers-list">
    <template>
        <style>
        :host {
            /*  @apply(--layout-vertical);
            @apply(--paper-font-body2);
            margin-top: 51px;
            margin-right: 15px;
            margin-left: 5px;*/
            --paper-input-container-color: #ccc;
            --paper-input-container-focus-color: var(--default-primary-color);
            height: auto;
        }

        [main] {
            width: 100%;
            @apply(--layout-horizontal);
            @apply(--layout-wrap);
            /* border: 1px solid green;*/
            margin: 5px;
            @apply(--shadow-elevation-3dp);
            background: var(--paper-grey-100);
        }

        paper-toolbar {
            width: 100%;
            background-color: var(--paper-grey-200);
            margin: 5px;
            padding-bottom: 10px;
            color: gray;
            /* border: 1px solid green;*/
            @apply(--layout-center-center);
        }

        [content] {
            @apply(--layout-horizontal);
            /*  @apply(--layout-center-center);*/
            /*  @apply(--layout-wrap);*/
            /*width: 100%;*/
            padding: 0px 3px;
            margin: 3px;
            height: auto;
            /*  border: 1px solid red;*/
        }

        paper-toolbar breadcumb {
            @apply(--layout-flex);
        }

        [details] {
            @apply(--layout-vertical);
        }

        .fab-action {
            position: fixed;
            right: 60px;
            top: 90%;
        }

        search {
            bottom: 5px;
            margin-right: 2px;
        }

        iron-list {
            height: 800px;
            padding: 16px;
            color: black;
            width: 100%;
        }

        .letter span,
        {
            margin-left: 40px;
        }

        .letter {
            @apply(--layout-horizontal);
            width: 100%;
            border-bottom: 2px solid #ccc;
            font-size: 1.3em;
            margin-right: 30px;
            /*  border-bottom: 2px solid #ccc;*/
            /*class="layout horizontal" style="width:100%;
             left:20px;font-size:1.2em"*/
        }

        .numberOfRecords {
            @apply(--layout-horizontal);
            width: 100%;
            bottom: 10px;
            color: var(--paper-grey-500);
            margin-left: 30px;
            font-size: 1.3em;
            margin-top: 10px;
        }

        .numberOfRecords > * {
            margin-right: 5px;
        }

        paper-dialog {
            /*  @apply(--layout-vertical);*/
            /*width: calc(80% - 30px);
            height: calc(80% - 30px);
            background-color:#EDECEC;*/
            width: 100%;
            margin-top: 50px;
        }

        #alphabet {
            /*     border: 1px solid yellow;*/
            position: fixed;
            right: 2%;
            top: calc(24% - 10px);
            height: 800px;
            bottom: 0;
            font-size: 0.9em;
        }

        #alphabet a {
            text-decoration: none;
            color: var(--paper-grey-500);
        }

        #alphabet a:visited {
            color: var(--default-primary-color);
            ;
        }

        @media(min-width: 601px) {
            #alphabet {
                position: fixed;
                right: 2%;
                top: calc(40% - 10px);
                font-size: 0.9em;
            }
        }
        </style>
        <div main id="listDrivers">
            <paper-toolbar>
                <div class="flex">
                    <paper-input id='searchBar' label="Search" class="search" type="search" value="{{search}}"></paper-input>
                </div>
                <paper-dropdown-menu label='By' selected-item-label="{{resultBy}}">
                    <paper-menu class="dropdown-content">
                        <paper-item>Group</paper-item>
                        <paper-item>Terminal</paper-item>
                        <paper-item>Last Name</paper-item>
                        <paper-item>ID</paper-item>
                    </paper-menu>
                </paper-dropdown-menu>
                <!--   <paper-icon-button icon="mdi:account-search" on-click="showSearch"></paper-icon-button> -->
                <!--     <paper-icon-button icon="mdi:sort-alphabetical" class="dropdown-trigger"></paper-icon-button> -->
                <paper-icon-button icon="av:loop"></paper-icon-button>
                <paper-toggle-button class="blue" checked="{{sortApha}}">
                    <iron-icon icon="mdi:sort-alphabetical"></iron-icon>
                </paper-toggle-button>
            </paper-toolbar>
            <div class="numberOfRecords">
                <iron-icon icon="mdi:account-multiple"></iron-icon>
                <span>{{driversData.length}}</span><i>Records</i> </div>
            <div content>
                <!-- horizontal center layout https://api.myjson.com/bins/3c806-->
                <iron-ajax auto url="../../../drivers.json" handle-as="json" last-response="{{driversData
}}" on-response="_handleResponse" debounce-duration="300"></iron-ajax>
                <div class="layout horizontal center wrap flex ">
                    <template is="dom-repeat" items="{{orderDrivers}}" as='drivers'>
                        <div class="letter" hidden$="{{_compute(sortApha)}}">
                            <a name="{{drivers.firstLetter}}"></a><span>{{drivers.firstLetter}}</span></div>
                        <template is=dom-repeat items="{{drivers.drivers}}" as="item" on-click="viewDriverInfo" id="driversList">
                            <driver-card id="{{item.email}}" data="{{item}}" on-click='_view'></driver-card>
                        </template>
                    </template>
                </div>
                <div id="alphabet" class=" layout vertical" hidden$="{{_compute(sortApha)}}">
                    <template is="dom-repeat" items="{{alphabet}}">
                        <div class='layout horizontal' id$='{{_letterId(item)}}'>
                            <a href$="{{_urlForItem(item)}}"> <span>{{item}}</span></a>
                        </div>
                    </template>
                </div>
            </div>
        </div>
        <!--   <array-selector id="selector" items="{{driversData}}" selected="{{selected}}" multi></array-selector> -->
        <!--   <div main id="viewDriver">
            <paper-toolbar>
                <span>{{header}}</span>
                <span class="flex"></span>
                <iron-icon icon="arrow-back" on-click="viewDrivers"></iron-icon>
            </paper-toolbar>

            <driver-profile driver-data="[[selected]]"></driver-profile>

        </div> -->
        <iron-media-query query="(min-width: 601px)" query-matches="{{_isMobile}}"></iron-media-query>
        <iron-media-query query="(min-width: 1280px)" query-matches="{{_isMobile}}"></iron-media-query>
    </template>
    <script>
    Polymer({
        is: 'drivers-list',
        properties: {
            driversData: {
                type: Array,
                notify: true,
                value: function() {
                    return [];
                }

            },
            search: {
                type: String,
                notify: true,
                observer: '_filterSearch',
                value: ''
            },
            header: {
                type: String,
                value: 'DRIVERS'
            },

            selectedDriver: {
                type: Array,
                value: []
            },
            searchBarHidden: {
                type: Boolean,
                value: function() {
                    return this.$.searchBar.style.display === 'none';
                }
            },

            resultBy: {
                type: String,
                value: 'Last Name',
                notify: true
            },

            orderDrivers: {
                type: Array,
                notify: true,
                value: function() {
                    return [];
                }
            },

            sortApha: {
                type: Boolean,
                value: function() {
                    return false;
                },
                observer: '_compute'
            },
            alphabet: {
                type: Array,
                value: function() {
                    return ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
                }
            },
            _isMobile: {
                type: Boolean,
                value: true,
                observer: '_isMobileChanged'
            }



        },
        _letterId: function(id) {
            return '_' + id;
        },

        _isMobileChanged: function(isMobile) {
            // console.log('mobile changed' + isMobile);

            for (var i = 1; i < this.alphabet.length; i += 2) {
                var id = '#_' + this.alphabet[i];
                if (document.querySelector(id) !== null) {
                    if (isMobile) {
                        document.querySelector(id).style.display = 'none';
                    } else {
                        document.querySelector(id).style.display = 'flex';
                    }

                    //  document.querySelector(id).innerHTML = '.';
                }

            }

        },

        _urlForItem: function(i) {

            return '#' + i;
        },
        _compute: function() {
            if (this.sortApha) {
                this._isMobileChanged(true);
            }
            return !this.sortApha;


        },


        _updateRoute: function(driversData) {

            // console.log(driversData);
        },

        _filterSearch: function() {
            this.sortApha = false;
            var id = '',
                i = 0;

            if (this.resultBy === 'Last Name') {
                for (i = 0; i < this.driversData.length; i++) {
                    if (this.driversData[i].name.indexOf(this.search.toUpperCase()) === -1) {
                        id = this.driversData[i].email;
                        // console.log(id);
                        document.getElementById(id).style.display = 'none';
                    }
                }
            } else if (this.resultBy === 'Group') {
                for (i = 0; i < this.driversData.length; i++) {
                    if (this.driversData[i].Group !== this.search.toUpperCase()) {
                        id = this.driversData[i].email;
                        document.getElementById(id).style.display = 'none';
                    }
                }

            }

            if (this.search === '') {
                for (i = 0; i < this.driversData.length; i++) {
                    if (this.driversData[i].name.indexOf(this.search.toUpperCase()) > -1) {
                        id = this.driversData[i].email;
                        //   console.log(id);
                        document.getElementById(id).style.display = 'flex';
                    }
                }
            }




        },

        byFirstName: function(a, b) {
            if (a.name < b.name) {
                return -1;
            }
            if (a.name > b.name) {
                return 1;
            }
            return 0;

        },
        _handleResponse: function(e) {
            this._orderAphabetical();
            console.log(e.detail.response);
        },

        showSearch: function() {

            if (this.searchBarHidden) {
                this.$.searchBar.style.display = 'block';
            } else {
                this.$.searchBar.style.display = 'none';
            }
            this.searchBarHidden = !this.searchBarHidden;

        },

        _view: function(e) {

            /*   this.sharedElements = {
                   'card': this.$.listDrivers
               };
               console.log(this.sharedElements.card);*/
            // // toggleSelection
            console.log(e.model.item);
            // var item = this.$.driversList.itemForElement(e.target);
            this.set('selectedDriver', e.model.item);
            Polymer.dom(this).parentNode.selected = 'driverProfile';


        },


        ready: function() {
            //    this.driversData = window.driversData;
            //  this.$.searchBar.style.display = 'none';

            this.sortApha = false;
            // this._orderAphabetical();



        },
        /*,
                bahaviors: [Polymer.NeonSharedElementAnimatableBehavior]*/

        _orderAphabetical: function() {

            this.driversData.sort(function(a, b) {


                if (a.name < b.name) {
                    return -1;
                }
                if (a.name > b.name) {
                    return 1;
                }
                return 0;


            });
            var letters = [];
            for (var i = 0; i < this.driversData.length; i++) {


                var items = {};
                var firstLetter = this.driversData[i].name.substring(0, 1).toUpperCase();
                if (letters.indexOf(firstLetter) === -1) {

                    items.firstLetter = firstLetter;
                    items.drivers = [];
                    for (var j = 0; j < this.driversData.length; j++) {
                        if (this.driversData[j].name.substring(0, 1).toUpperCase() === firstLetter) {
                            items.drivers.push(this.driversData[j]);
                        }
                    }
                    letters.push(firstLetter);
                    this.push('orderDrivers', items);
                }



            }
            // this.set('driversData',this.orderDrivers);

        }



    });
    </script>
</dom-module>
